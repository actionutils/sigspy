# sigspy

[![OpenSSF Scorecard](https://api.scorecard.dev/projects/github.com/actionutils/sigspy/badge)](https://scorecard.dev/viewer/?uri=github.com/actionutils/sigspy)

Extract and parse certificate extensions from Sigstore-signed certificates.

## Installation

### Quick install (latest)

```shell
curl -sL https://github.com/actionutils/sigspy/releases/latest/download/install.sh | \
  (tmpfile=$(mktemp); cat > "$tmpfile"; \
   gh attestation verify --repo=actionutils/sigspy --signer-repo=actionutils/trusted-go-releaser "$tmpfile" && \
   sh "$tmpfile"; rm -f "$tmpfile")
```

The install.sh script is generated by [binstaller](https://github.com/binary-install/binstaller).

### Quick install (specific version)

```shell
SIGSPY_VERSION=v1.0.0
curl -sL "https://github.com/actionutils/sigspy/releases/download/${SIGSPY_VERSION}/install.sh" | \
  (tmpfile=$(mktemp); cat > "$tmpfile"; \
   gh attestation verify --repo=actionutils/sigspy --signer-repo=actionutils/trusted-go-releaser "$tmpfile" && \
   sh "$tmpfile"; rm -f "$tmpfile")
```

### GitHub Actions

```yaml
- uses: binary-install/setup-x@v1
  with:
    script_url: https://github.com/actionutils/sigspy/releases/latest/download/install.sh
    gh_attestations_verify_flags: --repo=actionutils/sigspy --signer-repo=actionutils/trusted-go-releaser
```

Using [setup-x](https://github.com/binary-install/setup-x) action for binary installation.

### Using Go

```shell
go install github.com/actionutils/sigspy@latest
```

## Usage

```shell
sigspy -input-format=<format> < certificate_file
```

Formats:
- `pkcs7` (default) - PEM-encoded PKCS7 signatures (e.g., Git signatures)
- `der` - Raw binary certificate data
- `pem` - PEM-encoded certificates (-----BEGIN CERTIFICATE-----)

## Examples

```shell
# Parse gitsign signature
git cat-file tag v1.0.0 | sed -n '/-BEGIN/, /-END/p' | sed 's/^ //g' | sed 's/gpgsig //g' | sigspy | jq .

# Parse GitHub attestation
gh attestation verify artifact.txt --owner myorg --format json | \
  jq -r '.[0].attestation.bundle.verificationMaterial.certificate.rawBytes' | \
  base64 -d | sigspy -input-format=der | jq .

# Parse PEM certificate (decode base64 if needed)
curl -sL https://github.com/actionutils/sigspy/releases/download/v1.0.0/checksums.txt.pem | base64 -d | sigspy -input-format=pem | jq .

# Parse certificate from attestation JSONL
gh attestation download artifact.txt --owner myorg
cat *.jsonl | jq -r '.verificationMaterial.tlogEntries[0].canonicalizedBody' | \
  base64 -d | jq -r '.spec.signatures[0].verifier' | base64 -d | sigspy -input-format=pem | jq .
```

## Output

JSON containing parsed [Fulcio certificate extensions](https://github.com/sigstore/fulcio/blob/main/docs/oid-info.md):

```json
{
  "Issuer": "https://token.actions.githubusercontent.com",
  "GithubWorkflowTrigger": "push",
  "GithubWorkflowSHA": "91cce99aa1af750c246b622e3341a890900a3026",
  "GithubWorkflowName": "Release",
  "GithubWorkflowRepository": "actionutils/sigspy",
  "GithubWorkflowRef": "refs/heads/main",
  "BuildSignerURI": "https://github.com/actionutils/trusted-go-releaser/.github/workflows/trusted-release-workflow.yml@refs/tags/v0",
  "BuildSignerDigest": "18dbcad44783005261a22d90382dd03adeaefc12",
  "RunnerEnvironment": "github-hosted",
  "SourceRepositoryURI": "https://github.com/actionutils/sigspy",
  "SourceRepositoryDigest": "91cce99aa1af750c246b622e3341a890900a3026",
  "SourceRepositoryRef": "refs/heads/main",
  "SourceRepositoryIdentifier": "967219080",
  "SourceRepositoryOwnerURI": "https://github.com/actionutils",
  "SourceRepositoryOwnerIdentifier": "206433623",
  "BuildConfigURI": "https://github.com/actionutils/sigspy/.github/workflows/release.yml@refs/heads/main",
  "BuildConfigDigest": "91cce99aa1af750c246b622e3341a890900a3026",
  "BuildTrigger": "push",
  "RunInvocationURI": "https://github.com/actionutils/sigspy/actions/runs/16041355680/attempts/1",
  "SourceRepositoryVisibilityAtSigning": "public"
}
```

## Author

| | |
|---|---|
| <img src="https://github.com/haya14busa.png" width="60" height="60" alt="haya14busa" /> | **haya14busa**<br/>[![GitHub followers](https://img.shields.io/github/followers/haya14busa.svg?style=flat&label=Follow&logo=github)](https://github.com/haya14busa) [![GitHub Sponsors](https://img.shields.io/badge/Sponsor-EA4AAA?style=flat&logo=github-sponsors&logoColor=white)](https://github.com/sponsors/haya14busa) |
